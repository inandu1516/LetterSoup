<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sopa Lletres</title>
    <link href="css/sopa.css" rel="stylesheet">
    <script src="js/jquery-1.12.3.js"></script>
    <script>
        $(document).ready(function(){

            $("table").hide();

            var paraulesEntrades = [];

            var paraulesTrobades = [];

            var filas = 20;
            var cols = 10;

            var Sopa = {
                'grid': [],
                'init': function () {
                    for (var x = 0; x < cols; x++) {
                        Sopa.grid[x] = [];
                        for (var y = 0; y < filas; y++) {
                            var unicode = Math.round(Math.random() * ((89 - 65)+1) + 65 );
                            Sopa.grid[x][y] = String.fromCharCode(unicode);
                        }
                    }
                },
                'printaGrid': function () {
                    for (var i = 0; i < cols; i++) {
                        $("table").append("<tr id='" + i + "'>");
                        for (var j = 0; j < filas; j++) {
                            $("#"+i).append("<td>" + Sopa.grid[i][j] + "</td>");
                        }
                    }
                },
                'deleteGrid': function () {
                    $("table").empty();
                },
                'afegirParaula': function (paraula){
                    var ok = false;

                    do {
                        var llargada = paraula.length;
                        var p_lletres = paraula.toUpperCase().split('');
                        console.log(p_lletres);

                        var x = Math.round(Math.random() * ((9 - 0)+1) + 0);
                        var y = Math.round(Math.random() * ((9 - 0)+1) + 0);
                        var z = Math.round(Math.random() * 1 + 0);
                        console.log("Random punt: ["+x+"]["+y+"]" );
                        console.log("llargada: " + llargada);
                        if (z) {
                            if ((filas - y) >= llargada) {                     //afegim paraula horitzontal
                                ok = true;
                                var c = 0;
                                for (var k = y; k < y + llargada; k++) {
                                    console.log("[" + x + "][" + k + "]");
                                    Sopa.grid[x][k] = "<b>" +  p_lletres[c] + "</b>";
                                    c++;
                                }
                            }
                        } else {
                            if ((cols - x) >= llargada) {                    //afegim paraula vertical
                                ok = true;
                                var q = 0;
                                for (var p = x; p < x + llargada; p++) {
                                    console.log("[" + p + "][" + y + "]");
                                    Sopa.grid[p][y] = "<b>" + p + "</b>";
                                    Sopa.grid[p][y] = "<b>" +  p_lletres[q] + "</b>";
                                    q++;
                                }
                            }
                        }
                    }while(ok == false);

                    console.log(ok);
                }
            };

            Sopa.init();

            $("#start").click(function(){
                Sopa.printaGrid();
                $("td").click(tdSelect);
                $("table").fadeIn(1500);
            });

            $("form").submit(function (){
                var paraula = $("#entrada").val();
                $("#entrada").val('');
                paraulesEntrades.push(paraula.toUpperCase());
                Sopa.afegirParaula(paraula);
                console.log("paraulesEntrades: " + paraulesEntrades);
            });

            function tdSelect(){
                $(this).toggleClass("selected");
                var lletres = $(".selected").text();
                console.log("\n" + lletres + "\n");
                $("#paraula").text(lletres);

                for (var i = 0; i < paraulesEntrades.length; i++){
                    console.log("paraulesEntrades["+i+"]: " + paraulesEntrades[i]);
                    if($("#paraula").text() == paraulesEntrades[i]){
                        alert("Paraula trobada!");
                        paraulesTrobades.push(paraulesEntrades[i]);
                        correcte();
                    }
                }

                console.log(paraulesTrobades);
            }

            function correcte() {
                $(".selected").addClass("adivinada");
                $(".adivinada").removeClass("selected");
            }

        });
    </script>
</head>
<body>
    <form>
        <input id="entrada" type="text" name="txt" />
    </form>
    <button id="start">Start</button>
    <div id="sopa">
        <table></table>
    </div>
    <p id="paraula"></p>
</body>
</html>